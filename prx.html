<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blocksi Proxy</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="proxy-page">
    <div class="proxy-header">
      <div class="proxy-title">
        <img src="/res/logo-1.svg" alt="Blocksi" class="proxy-logo" />
        <h1>Proxy</h1>
      </div>
      <div class="proxy-search">
        <input id="proxyUrl" type="text" placeholder="Enter URL (https://example.com)" />
        <button id="proxyGo">Go</button>
      </div>
    </div>

    <div class="proxy-body">
      <div class="proxy-left">
        <div class="proxy-panel">
          <div class="panel-title">History</div>
          <ul id="historyList" class="history-list"></ul>
        </div>
      </div>

      <div class="proxy-right">
        <div class="proxy-panel">
          <div class="panel-title">Preview</div>
          <div class="proxy-frame-wrap">
            <iframe id="proxyFrame" class="proxy-frame"></iframe>
            <div id="proxyError" class="proxy-error">Enter a valid URL to load a site.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const proxyUrlInput = document.getElementById("proxyUrl");
    const proxyGo = document.getElementById("proxyGo");
    const proxyFrame = document.getElementById("proxyFrame");
    const proxyError = document.getElementById("proxyError");
    const historyList = document.getElementById("historyList");

    let history = [];

    function saveHistory(url) {
      history.unshift(url);
      if (history.length > 10) history.pop();
      renderHistory();
    }

    function renderHistory() {
      historyList.innerHTML = "";
      history.forEach((url) => {
        const li = document.createElement("li");
        li.textContent = url;
        li.addEventListener("click", () => {
          proxyUrlInput.value = url;
          loadProxy(url);
        });
        historyList.appendChild(li);
      });
    }

    function validUrl(url) {
      try {
        new URL(url);
        return true;
      } catch {
        return false;
      }
    }

    function loadProxy(url) {
      if (!validUrl(url)) {
        proxyError.textContent = "Invalid URL. Make sure it starts with https://";
        proxyError.style.display = "block";
        proxyFrame.style.display = "none";
        return;
      }

      proxyError.style.display = "none";
      proxyFrame.style.display = "block";

      const proxyEndpoint = `/api/proxy?url=${encodeURIComponent(url)}`;
      proxyFrame.src = proxyEndpoint;

      saveHistory(url);
    }

    proxyGo.addEventListener("click", () => {
      loadProxy(proxyUrlInput.value.trim());
    });

    proxyUrlInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        loadProxy(proxyUrlInput.value.trim());
      }
    });
  </script>
  <script src="/frame.js"></script>
</body>
</html>
